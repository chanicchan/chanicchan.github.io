<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rutherford vs Thomson Scattering</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Prevent scrolling on mobile */
        }

        header {
            padding: 15px;
            text-align: center;
            background: #1e1e1e;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 10;
        }

        h1 {
            margin: 0;
            font-size: 1.2rem;
            color: #fff;
        }

        /* Main layout: Canvas takes available space */
        .simulation-area {
            flex-grow: 1;
            position: relative;
            width: 100%;
            background: #000;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* Controls overlay */
        .controls {
            background: #1e1e1e;
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            align-items: center;
            border-top: 1px solid #333;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-size: 0.8rem;
            color: #aaa;
            font-weight: bold;
            text-transform: uppercase;
        }

        .btn-group {
            display: flex;
            background: #333;
            border-radius: 6px;
            overflow: hidden;
        }

        button {
            background: #333;
            color: #ccc;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        button:hover { background: #444; }
        
        button.active {
            background: #00bcd4;
            color: #000;
        }

        input[type="range"] {
            width: 150px;
            cursor: pointer;
        }

        .stats {
            font-family: monospace;
            font-size: 0.85rem;
            background: #2c2c2c;
            padding: 5px 10px;
            border-radius: 4px;
            border-left: 3px solid #ff9800;
        }

        /* Legend Overlay inside canvas */
        .legend-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 8px;
            pointer-events: none;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            margin-bottom: 4px;
        }
        .dot { width: 8px; height: 8px; border-radius: 50%; }
    </style>
</head>
<body>

    <header>
        <h1>Alpha Particle Scattering Experiment</h1>
    </header>

    <div class="simulation-area">
        <canvas id="simCanvas"></canvas>
        <div class="legend-overlay">
            <div class="legend-item">
                <span class="dot" style="background:#ffeb3b;"></span> Alpha Particle
            </div>
            <div class="legend-item" id="legend-target">
                <span class="dot" style="background:#ff5722;"></span> Gold Nucleus
            </div>
            <div style="margin-top:5px; font-size: 0.75rem; color:#bbb; max-width: 200px;" id="model-explanation">
                Most particles pass through empty space.
            </div>
        </div>
    </div>

    <div class="controls">
        <div class="control-group">
            <label>Atomic Model</label>
            <div class="btn-group">
                <button id="btn-plum">Plum Pudding</button>
                <button id="btn-rutherford" class="active">Rutherford</button>
            </div>
        </div>

        <div class="control-group">
            <label>Beam Speed</label>
            <input type="range" id="speed-slider" min="5" max="15" value="8">
        </div>

        <div class="control-group">
            <label>Statistics</label>
            <div class="stats">
                Fired: <span id="count-total">0</span><br>
                Backscattered: <span id="count-hit">0</span>
            </div>
        </div>

        <button id="btn-clear" style="border-radius: 6px;">Clear Trails</button>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.querySelector('.simulation-area');

        // State
        let width, height;
        let particles = [];
        let atoms = [];
        let MODE = 'rutherford'; // 'plum' or 'rutherford'
        
        // Counters
        let totalParticles = 0;
        let backScatters = 0;
        let spawnTimer = 0;

        // Physics Configuration
        const RUTH_K = 2500;  // Strong force for nucleus
        const PLUM_K = 15;    // Very weak force (diffuse charge) - reduced from 150
        const ATOM_RADIUS_PLUM = 60;
        const ATOM_RADIUS_RUTH = 5; // Visual radius only
        
        // UI Elements
        const uiTotal = document.getElementById('count-total');
        const uiHit = document.getElementById('count-hit');
        const btnPlum = document.getElementById('btn-plum');
        const btnRuth = document.getElementById('btn-rutherford');
        const speedSlider = document.getElementById('speed-slider');
        const legendText = document.getElementById('model-explanation');

        // --- Resizing Logic (Fixes Elongation) ---
        function resize() {
            // Set canvas internal resolution to match the CSS display size
            width = container.clientWidth;
            height = container.clientHeight;
            
            canvas.width = width;
            canvas.height = height;
            
            initAtoms(); // Re-center atoms when screen changes
        }
        window.addEventListener('resize', resize);

        // --- Classes ---

        class Atom {
            constructor(x, y) {
                this.x = x;
                this.y = y;
            }

            draw() {
                if (MODE === 'rutherford') {
                    // Tiny Nucleus
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, ATOM_RADIUS_RUTH, 0, Math.PI * 2);
                    ctx.fillStyle = '#ff5722'; // Deep Orange
                    ctx.fill();
                    
                    // Faint hint of electron shells (mostly empty space)
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, ATOM_RADIUS_PLUM, 0, Math.PI * 2);
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                    ctx.stroke();
                } else {
                    // Plum Pudding: Large diffuse positive sphere
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, ATOM_RADIUS_PLUM, 0, Math.PI * 2);
                    // Radial gradient to look like a cloud
                    let grad = ctx.createRadialGradient(this.x, this.y, 10, this.x, this.y, ATOM_RADIUS_PLUM);
                    grad.addColorStop(0, 'rgba(255, 87, 34, 0.3)');
                    grad.addColorStop(1, 'rgba(255, 87, 34, 0.05)');
                    ctx.fillStyle = grad;
                    ctx.fill();

                    // Electrons (The Plums)
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                    ctx.font = "12px Arial";
                    ctx.fillText("-", this.x - 20, this.y - 20);
                    ctx.fillText("-", this.x + 20, this.y + 10);
                    ctx.fillText("-", this.x - 10, this.y + 30);
                    ctx.fillText("-", this.x + 5, this.y - 35);
                }
            }
        }

        class Particle {
            constructor() {
                this.reset();
                // Pre-warm trails slightly off-screen
                this.x = -10;
            }

            reset() {
                this.x = 0;
                // Spread particles across the height, centered on atoms
                // We target the center row of atoms mostly for the demo
                let spread = height * 0.6; 
                this.y = (height / 2) - (spread/2) + Math.random() * spread;
                
                this.speed = parseFloat(speedSlider.value);
                this.vx = this.speed;
                this.vy = 0;
                
                this.history = [];
                this.dead = false;
                this.deflected = false;
                
                totalParticles++;
                uiTotal.innerText = totalParticles;
            }

            update() {
                // Physics
                let forceX = 0;
                let forceY = 0;

                for (let atom of atoms) {
                    let dx = this.x - atom.x;
                    let dy = this.y - atom.y;
                    let distSq = dx*dx + dy*dy;
                    let dist = Math.sqrt(distSq);

                    if (MODE === 'rutherford') {
                        // Rutherford: 1/r^2 repulsion
                        // Cap distance to prevent division by zero/explosion
                        if (dist > 2 && dist < 150) {
                            let f = RUTH_K / distSq; 
                            forceX += f * (dx / dist);
                            forceY += f * (dy / dist);
                        }
                    } else {
                        // Plum Pudding: Linear repulsion inside the sphere (E ~ r)
                        // Outside the sphere, it acts like 1/r^2 but much weaker
                        if (dist < ATOM_RADIUS_PLUM) {
                            // Inside: Force pushes away from center, increasing with r 
                            // (Simulating pushing through positive charge cloud)
                            // Note: Actually, E-field is E = kQr/R^3 inside a uniform sphere.
                            // We simplify to a weak push away.
                            let strength = PLUM_K * (dist / (ATOM_RADIUS_PLUM * ATOM_RADIUS_PLUM)); 
                            forceX += strength * (dx / dist);
                            forceY += strength * (dy / dist);
                        }
                    }
                }

                this.vx += forceX;
                this.vy += forceY;

                // Move
                this.x += this.vx;
                this.y += this.vy;

                // Trail management
                if (this.history.length === 0 || 
                    Math.abs(this.x - this.history[this.history.length-1].x) > 4 ||
                    Math.abs(this.y - this.history[this.history.length-1].y) > 4) {
                    this.history.push({x: this.x, y: this.y});
                }
                if (this.history.length > 40) this.history.shift();

                // Stats for Rutherford Backscatter
                if (MODE === 'rutherford' && !this.deflected) {
                    // If moving left (vx < 0), it bounced back
                    if (this.vx < 0) {
                        this.deflected = true;
                        backScatters++;
                        uiHit.innerText = backScatters;
                    }
                }

                // Kill if off screen
                if (this.x > width + 50 || this.x < -50 || this.y < -50 || this.y > height + 50) {
                    this.dead = true;
                }
            }

            draw() {
                ctx.beginPath();
                ctx.strokeStyle = 'rgba(255, 235, 59, 0.4)';
                ctx.lineWidth = 2;
                if (this.history.length > 0) {
                    ctx.moveTo(this.history[0].x, this.history[0].y);
                    for (let p of this.history) ctx.lineTo(p.x, p.y);
                }
                ctx.lineTo(this.x, this.y);
                ctx.stroke();

                ctx.fillStyle = '#ffeb3b';
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2.5, 0, Math.PI*2);
                ctx.fill();
            }
        }

        // --- Main Logic ---

        function initAtoms() {
            atoms = [];
            // Create a centered layout of atoms
            const rows = 3;
            const cols = 3;
            const spacingX = 140;
            const spacingY = 140;
            
            let startX = (width / 2) - ((cols-1) * spacingX) / 2;
            let startY = (height / 2) - ((rows-1) * spacingY) / 2;

            for(let r=0; r<rows; r++) {
                for(let c=0; c<cols; c++) {
                    // Add slight offset to make it look natural
                    let offY = (c % 2 === 0) ? 0 : 30; 
                    atoms.push(new Atom(startX + c*spacingX, startY + r*spacingY + offY));
                }
            }
        }

        function loop() {
            // Fade effect for trails? No, clear fully for clean physics lines
            ctx.fillStyle = 'black'; 
            ctx.fillRect(0, 0, width, height);

            // Draw Atoms
            for (let a of atoms) a.draw();

            // Spawn Particles
            spawnTimer++;
            // Spawn faster if slider is high
            if (spawnTimer > 5) {
                particles.push(new Particle());
                spawnTimer = 0;
            }

            // Update Particles
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.update();
                p.draw();
                if (p.dead) particles.splice(i, 1);
            }

            requestAnimationFrame(loop);
        }

        // --- Event Listeners ---

        document.getElementById('btn-clear').onclick = () => {
            particles = [];
            totalParticles = 0;
            backScatters = 0;
            uiTotal.innerText = "0";
            uiHit.innerText = "0";
        };

        btnPlum.onclick = () => {
            MODE = 'plum';
            btnPlum.classList.add('active');
            btnRuth.classList.remove('active');
            legendText.innerText = "Positive charge is spread out. The weak electric field causes only minor deviations. No backscattering.";
            particles = []; // Clear to show fresh behavior
        };

        btnRuth.onclick = () => {
            MODE = 'rutherford';
            btnRuth.classList.add('active');
            btnPlum.classList.remove('active');
            legendText.innerText = "Positive charge is concentrated. Direct hits cause massive deflection (backscattering).";
            particles = [];
        };

        // Init
        resize(); // Set initial size
        loop();

    </script>
</body>
</html>